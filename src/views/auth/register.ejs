<!doctype html>
<html lang="en">
<%- include('../partials/head') %>
   <link rel="stylesheet" href="/css/login.css">

   <body>
      <div class="container text-center">
         <div class="row">
            <div class="col">
               <div class="container d-flex justify-content-center align-items-center min-vh-100">
                  <div class="row border rounded-5 p-3 bg-white shadow box-area" style="min-height: 520px;">
                     <div
                        class="col-md-6 rounded-4 d-flex justify-content-center align-items-center flex-column left-box"
                        style="background: #099584;">
                        <div class="featured-image mb-3">
                           <img src="/images/Doctors-bro.png" class="img-fluid" style="width: 300px;">
                        </div>
                        <p class="text-white fs-5 mb-1">¡Hola de nuevo!</p>
                        <small class="text-white text-wrap text-center">
                           Ingresa tu correo y contraseña para empezar.
                        </small>
                     </div>
                     <div class="col-md-6 right-box">
                        <form id="registerForm" action="/auth/register" method="POST"
                           class="d-flex justify-content-between flex-column h-100">
                           <div class="d-flex flex-column">
                              <div class="header-text mb-3 text-start">
                                 <h2 class="fw-bold">Crea tu cuenta.</h2>
                                 <p class="mb-0">Regístrate para empezar a usar la plataforma.</p>
                              </div>
                              <!-- Nombre -->
                              <div class="input-group mb-3">
                                 <input type="text" class="form-control form-control-lg bg-light fs-6"
                                    placeholder="Nombre completo" name="name" autocomplete="name" required>
                              </div>
                              <!-- Correo -->
                              <div class="input-group mb-3">
                                 <input type="email" class="form-control form-control-lg bg-light fs-6"
                                    placeholder="Correo electrónico" name="email" autocomplete="email" required>
                              </div>
                              <!-- Contraseña -->
                              <div class="input-group mb-3">
                                 <input type="password" class="form-control form-control-lg bg-light fs-6"
                                    placeholder="Contraseña" name="password" autocomplete="new-password" required>
                              </div>
                              <!-- Confirmar contraseña -->
                              <div class="input-group mb-3">
                                 <input type="password" class="form-control form-control-lg bg-light fs-6"
                                    placeholder="Confirma contraseña" name="confirmPassword" autocomplete="new-password"
                                    required>
                              </div>
                           </div>
                           <div class="d-flex flex-column">
                              <!-- Botón de registro -->
                              <div class="input-group mb-3">
                                 <button class="btn btn-lg w-100 fs-6" type="submit"
                                    style="background-color: #099584; color: #FFFFFF;">
                                    Regístrate
                                 </button>
                              </div>
                              <!-- Enlace al login -->
                              <div class="row">
                                 <small>¿Ya tienes cuenta? <a href="/auth/login">Inicia sesión</a></small>
                              </div>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <%- include('../partials/scripts') %>
         <script>
            $(document).on("submit", "#registerForm", function (e) {
               e.preventDefault();

               const password = $(this).find('input[name="password"]').val();
               const confirmPassword = $(this).find('input[name="confirmPassword"]').val();
               const $submitBtn = $(this).find('button[type="submit"]');

               if (password !== confirmPassword) {
                  Toast.fire({
                     icon: "error",
                     title: "Las contraseñas no coinciden"
                  });
                  return;
               }

               if (validarFormulario(this.id)) {
                  console.log("✅ Formulario válido");

                  $.ajax({
                     url: $(this).attr("action"),
                     method: $(this).attr("method"),
                     data: $(this).serialize(),
                     beforeSend: function () {
                        // Desactivar el botón antes de enviar
                        $submitBtn.prop('disabled', true).text('Registrando...');
                     }
                  }).done(function (response) {
                     console.log(response);
                     
                     if (response.success) {
                        console.log("✅", response.message);

                        Toast.fire({
                           icon: "success",
                           title: response.message
                        });

                        setTimeout(() => {
                           window.location.href = "/auth/login"; // Redirigir al login después de 3 segundos
                        }, 3000); // 3000 ms = 3 segundos
                     } else {
                        console.log("❌", response.message);
                        Toast.fire({
                           icon: "error",
                           title: response.message
                        });
                     }
                  }).always(function () {
                     // Volver a activar el botón después de terminar
                     $submitBtn.prop('disabled', false).text('Registrarse');
                  });
               } else {
                  console.log("❌ Formulario inválido");
                  Toast.fire({
                     icon: "error",
                     title: "Formulario inválido",
                     text: "Por favor, completa todos los campos requeridos."
                  });
               }
            });
         </script>
   </body>

</html>